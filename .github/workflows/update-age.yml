name: Atualizar idade automaticamente

on:
  schedule:
    - cron: '0 0 * * *'  # roda todo dia à meia-noite UTC
  workflow_dispatch: # permite rodar manualmente

jobs:
  update-age:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout do código
      uses: actions/checkout@v3

    - name: Calcular idade e substituir no README
      run: |
        # Configurar data de nascimento
        BIRTH_YEAR=2004
        BIRTH_MONTH=8
        BIRTH_DAY=20

        TODAY=$(date +%Y-%m-%d)
        BIRTH_DATE="$BIRTH_YEAR-$BIRTH_MONTH-$BIRTH_DAY"

        AGE=$(($(date +%Y) - BIRTH_YEAR))
        # Ajustar se o aniversário ainda não passou neste ano
        if [[ "$(date +%m%d)" < $(printf "%02d%02d" $BIRTH_MONTH $BIRTH_DAY) ]]; then
          AGE=$((AGE - 1))
        fi

        echo "Idade calculada: $AGE"

        # Substituir __AGE__ pelo valor calculado no README.md
        sed -i "s/__AGE__/${AGE}/g" README.md

    - name: Commit e push das mudanças
      uses: stefanzweifel/git-auto-commit-action@v4
      with:
        commit_message: "Atualizar idade para ${{ steps.update-age.outputs.age }}"
        file_pattern: README.md
